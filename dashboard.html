<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel do Centro — InfoLearn</title>

<style>
/* ===== Estilo Geral ===== */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background:#f0f2f5; color:#333; line-height:1.6; }

/* ===== Navbar ===== */
.navbar {
  display:flex; justify-content:space-between; align-items:center;
  background:#4a90e2; color:#fff; padding:12px 20px;
  box-shadow:0 2px 6px rgba(0,0,0,0.2); position:sticky; top:0; z-index:1000;
}
.navbar .logo { font-weight:bold; font-size:1.3rem; }
.navbar nav a { color:#fff; text-decoration:none; margin-left:20px; font-weight:500; }
.hamburger { display:none; cursor:pointer; font-size:1.5rem; }

/* ===== Perfil do usuário ===== */
.user-profile {
  display:flex; align-items:center; gap:10px; cursor:pointer; position:relative;
}
.user-profile img {
  width:36px; height:36px; border-radius:50%; object-fit:cover; border:2px solid #fff;
}
.user-profile span { font-weight:500; }

/* Dropdown do perfil */
.user-dropdown {
  display:none; position:absolute; top:45px; right:0;
  background:#fff; color:#333; padding:10px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2);
  min-width:150px; z-index:1001;
}
.user-dropdown button {
  width:100%; background:none; border:none; padding:8px; cursor:pointer; text-align:left;
  transition:0.2s; border-radius:6px;
}
.user-dropdown button:hover { background:#f0f0f0; }

/* ===== Formulário ===== */
.form-box {
  max-width:700px; margin:30px auto; background:#fff;
  padding:25px 30px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1);
}
.form-box h2 { text-align:center; margin-bottom:20px; color:#4a90e2; }
.form-box label { display:block; margin-top:15px; font-weight:500; }
.form-box input, .form-box textarea, .form-box select {
  width:100%; padding:10px 12px; margin-top:5px;
  border:1px solid #ccc; border-radius:8px; transition:all 0.3s ease;
}
.form-box input:focus, .form-box textarea:focus, .form-box select:focus {
  outline:none; border-color:#4a90e2; box-shadow:0 0 5px rgba(74,144,226,0.3);
}
.btn {
  display:inline-block; margin-top:20px; padding:12px 20px;
  background:#4a90e2; color:#fff; border:none; border-radius:8px;
  cursor:pointer; font-weight:bold; transition:all 0.3s ease;
}
.btn:hover { background:#357ABD; }

/* ===== Preview ===== */
#centerPreview img { max-width:100%; border-radius:8px; margin-bottom:10px; }
#centerPreview h3 { color:#333; margin-bottom:8px; }
#centerPreview p { color:#555; }

/* ===== Histórico ===== */
.center-card {
  background:#f7f9fc; border-radius:10px; padding:15px; margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
.center-card img { max-width:80px; border-radius:6px; margin-right:10px; vertical-align:middle; }
.center-card h4 { margin-bottom:5px; color:#4a90e2; display:inline-block; vertical-align:middle; }

/* ===== Responsivo ===== */
@media(max-width:768px){
  .navbar nav { display:none; }
  .hamburger { display:block; }
}
</style>
</head>

<body>
<header class="navbar">
  <div class="logo">InfoLearn</div>
  <nav><a href="index.html">Início</a></nav>

  <!-- Perfil do usuário -->
  <div class="user-profile" id="userProfile">
    <img id="userPhoto" src="https://via.placeholder.com/36" alt="Foto do usuário">
    <span id="userName">Usuário</span>
    <div class="user-dropdown" id="userDropdown">
      <button onclick="logout()">Sair</button>
    </div>
  </div>

  <div class="hamburger" onclick="toggleNav()">☰</div>
</header>

<section class="form-box">
  <h2>Painel do Centro</h2>
  <div id="statusArea" style="margin-bottom:12px;color:#333;"></div>

  <form id="centerForm">
    <label>Nome do Centro *</label>
    <input id="centerName" required />

    <label>Descrição</label>
    <textarea id="centerDesc" rows="4" placeholder="Breve descrição"></textarea>

    <label>Logo (PNG/JPG)</label>
    <input type="file" id="centerLogo" accept="image/*" />

    <label>Fotos do Centro (até 6)</label>
    <input type="file" id="centerPhotos" accept="image/*" multiple />

    <label>Modo de Aulas</label>
    <select id="centerModes" multiple>
      <option value="Presencial">Presencial</option>
      <option value="Online - WhatsApp">Online - WhatsApp</option>
      <option value="Online - Google Meet">Online - Google Meet</option>
      <option value="Híbrido">Híbrido</option>
    </select>

    <label>Contacto (WhatsApp / Tel)</label>
    <input id="centerContact" placeholder="Ex: +258841234567" />

    <label>Link do vídeo-tutorial (YouTube/URL)</label>
    <input id="centerVideoLink" placeholder="https://..." />

    <label>Endereço (opcional)</label>
    <input id="centerAddress" placeholder="Cidade / Rua ..." />

    <button class="btn" type="submit">Salvar Centro</button>
  </form>

  <div style="margin-top:18px;">
    <button class="btn" id="btnShareCenter">Partilhar este Centro</button>
  </div>

  <div id="centerPreview" style="margin-top:20px;"></div>
  <div id="historyContainer" style="margin-top:30px;">
    <h3>Meus Centros Criados</h3>
    <div id="historyList"></div>
  </div>
</section>

<script type="module">
// ===== Funções de Autenticação / Storage (substitua conforme seu auth.js) =====
import { getCurrentUser, saveOrUpdateCenter, uploadFileToStorage, getCentersByUser } from './auth.js';

const statusArea = document.getElementById('statusArea');
const form = document.getElementById('centerForm');
const centerPreview = document.getElementById('centerPreview');
const btnShare = document.getElementById('btnShareCenter');
const historyList = document.getElementById('historyList');

const userProfile = document.getElementById('userProfile');
const userDropdown = document.getElementById('userDropdown');
const userNameSpan = document.getElementById('userName');
const userPhotoImg = document.getElementById('userPhoto');

async function init() {
  const user = await getCurrentUser();
  if (!user) { window.location.href = 'login.html'; return; }

  // Atualizar perfil na navbar
  userNameSpan.textContent = user.displayName || user.email || 'Usuário';
  if (user.photoURL) userPhotoImg.src = user.photoURL;

  statusArea.textContent = `Logado como: ${user.email}`;
  await loadHistory();
}

// Mostrar / ocultar dropdown
userProfile.addEventListener('click', ()=>{
  userDropdown.style.display = userDropdown.style.display === 'block' ? 'none' : 'block';
});

function logout(){
  // Substitua conforme sua função de logout
  alert('Função de logout ainda não implementada.');
}

// ===== Preview de Centro =====
function renderPreview(center) {
  centerPreview.innerHTML = '';
  if (!center) return;
  const html = [];
  if (center.logoUrl) html.push(`<img src="${center.logoUrl}" style="max-width:120px;border-radius:8px;margin-bottom:10px;">`);
  if (center.name) html.push(`<h3>${center.name}</h3>`);
  if (center.description) html.push(`<p>${center.description}</p>`);
  if (center.videoLink) html.push(`<p><a href="${center.videoLink}" target="_blank">Ver tutorial</a></p>`);
  if (center.photos && center.photos.length) {
    const thumbs = center.photos.map(p=>`<img src="${p}" style="width:80px;height:60px;object-fit:cover;margin:4px;border-radius:6px">`).join('');
    html.push(`<div>${thumbs}</div>`);
  }
  centerPreview.innerHTML = html.join('');
}

// ===== Histórico =====
async function loadHistory() {
  const user = await getCurrentUser();
  if (!user) return;
  const centers = await getCentersByUser(user.uid);
  historyList.innerHTML = '';
  if (!centers || !centers.length) {
    historyList.textContent = 'Nenhum centro criado ainda.';
    return;
  }
  centers.forEach(c => {
    const div = document.createElement('div');
    div.className = 'center-card';
    div.innerHTML = `
      ${c.logoUrl ? `<img src="${c.logoUrl}">` : ''}
      <h4>${c.name}</h4>
      <p>${c.description || ''}</p>
      <p><strong>Contato:</strong> ${c.contact || ''}</p>
      ${c.videoLink ? `<p><a href="${c.videoLink}" target="_blank">Ver tutorial</a></p>` : ''}
    `;
    historyList.appendChild(div);
  });
}

// ===== Submit do Form =====
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  statusArea.textContent = 'Salvando...';
  const user = await getCurrentUser();
  if (!user) { window.location.href='login.html'; return; }

  const data = {
    userId: user.uid,
    name: document.getElementById('centerName').value.trim(),
    description: document.getElementById('centerDesc').value.trim(),
    contact: document.getElementById('centerContact').value.trim(),
    videoLink: document.getElementById('centerVideoLink').value.trim(),
    address: document.getElementById('centerAddress').value.trim(),
    modes: Array.from(document.getElementById('centerModes').selectedOptions).map(o=>o.value)
  };

  const logoInput = document.getElementById('centerLogo');
  if (logoInput.files && logoInput.files[0]) {
    const file = logoInput.files[0];
    const path = `centers/${user.uid}/logo_${Date.now()}_${file.name}`;
    const url = await uploadFileToStorage(path, file);
    data.logoUrl = url;
  }

  const photosInput = document.getElementById('centerPhotos');
  if (photosInput.files && photosInput.files.length) {
    data.photos = data.photos || [];
    const files = Array.from(photosInput.files).slice(0,6);
    for (const f of files) {
      const path = `centers/${user.uid}/photo_${Date.now()}_${f.name}`;
      const url = await uploadFileToStorage(path, f);
      data.photos.push(url);
    }
  }

  try {
    await saveOrUpdateCenter(user.uid, data);
    statusArea.textContent='Centro salvo com sucesso!';
    renderPreview(data);
    await loadHistory();
  } catch(err){
    statusArea.textContent='Erro: '+err.message;
  }
});

// ===== Compartilhar =====
btnShare.addEventListener('click', async ()=>{
  const user = await getCurrentUser();
  if(!user) return alert('Faça login primeiro.');
  const url = `${location.origin}/index.html#centro`;
  if(navigator.share){
    navigator.share({ title:'Meu Centro', text:'Confira meu centro', url });
  } else {
    navigator.clipboard.writeText(url);
    alert('Link copiado para área de transferência: '+url);
  }
});

init();
</script>
</body>
</html>
