<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Vagalume IA | InfoLearn Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f4f8ff;
    color: #333;
}

/* ================== ANIMAÇÃO INICIAL ================== */
.splash {
    position: fixed;
    inset: 0;
    background: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 99;
    animation: splashOut 3s forwards;
}

@keyframes splashOut {
    0% { opacity: 1; }
    80% { opacity: 1; }
    100% { opacity: 0; visibility: hidden; }
}

.splash-box {
    text-align: center;
    animation: scaleIn 1.5s ease;
}

@keyframes scaleIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.splash-box img {
    width: 150px;
}

.splash-box h1 {
    color: #1e88e5;
    margin: 10px 0 5px;
}

.splash-box p {
    font-size: 14px;
    color: #666;
}

/* ================== CHAT ================== */
.chat-container {
    max-width: 420px;
    height: 100vh;
    margin: auto;
    background: #fff;
    display: flex;
    flex-direction: column;
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
}

.chat-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px;
    background: #1e88e5;
    color: white;
}

.chat-header img {
    width: 42px;
}

.chat-header small {
    font-size: 12px;
    opacity: 0.9;
}

.chat-box {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: #f9fbff;
}

.msg {
    margin-bottom: 12px;
    padding: 12px 15px;
    border-radius: 15px;
    max-width: 85%;
    font-size: 14px;
    line-height: 1.5;
}

.ia {
    background: #e3f2fd;
    color: #0d47a1;
}

.user {
    background: #1e88e5;
    color: #fff;
    margin-left: auto;
}

/* digitando */
.typing {
    font-style: italic;
    opacity: 0.7;
}

.chat-input {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ddd;
    background: #fff;
}

.chat-input input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

.chat-input button {
    margin-left: 8px;
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    background: #1e88e5;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- SPLASH -->
<div class="splash">
    <div class="splash-box">
        <img src="vagalume.png">
        <h1>Vagalume IA</h1>
        <p>A SECOS Intelligence</p>
    </div>
</div>

<!-- CHAT -->
<div class="chat-container">
    <div class="chat-header">
        <img src="vagalume.png">
        <div>
            <strong>Vagalume IA</strong><br>
            <small>A SECOS Intelligence</small>
        </div>
    </div>

    <div class="chat-box" id="chat"></div>

    <div class="chat-input">
        <input id="input" placeholder="Digite aqui...">
        <button onclick="enviar()">Enviar</button>
    </div>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

/* BACKEND (Render) */
const BACKEND = "https://backend-infolearn.onrender.com";

/* CONTROLE */
let etapa = 0;
let dados = {};

const perguntas = [
    "Olá. Sou a Vagalume IA da InfoLearn Academy. Vamos criar seu currículo profissional. Qual é o seu nome completo?",
    "Qual é sua área profissional ou especialidade técnica?",
    "Descreva suas experiências profissionais (empresas, anos e funções).",
    "Liste suas principais habilidades técnicas.",
    "Qual é o seu objetivo profissional?"
];

function addMsg(texto, tipo) {
    const div = document.createElement("div");
    div.className = "msg " + tipo;
    div.innerText = texto;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function typingIA(callback) {
    const t = document.createElement("div");
    t.className = "msg ia typing";
    t.innerText = "Vagalume IA está digitando...";
    chat.appendChild(t);
    chat.scrollTop = chat.scrollHeight;

    setTimeout(() => {
        chat.removeChild(t);
        callback();
    }, 1200);
}

setTimeout(() => {
    addMsg(perguntas[0], "ia");
}, 3000);

function enviar() {
    const texto = input.value.trim();
    if (!texto) return;

    addMsg(texto, "user");
    input.value = "";

    if (etapa === 0) dados.nome = texto;
    if (etapa === 1) dados.area = texto;
    if (etapa === 2) dados.experiencia = texto;
    if (etapa === 3) dados.habilidades = texto;
    if (etapa === 4) dados.objetivo = texto;

    etapa++;

    typingIA(() => {
        if (etapa < perguntas.length) {
            addMsg(perguntas[etapa], "ia");
        } else {
            addMsg(
                "Excelente. Todas as informações técnicas foram coletadas. Vou gerar seu Currículo Vitae profissional em PDF.",
                "ia"
            );
            gerarPDF();
        }
    });
}

async function gerarPDF() {
    typingIA(async () => {
        addMsg("Gerando o documento...", "ia");

        const res = await fetch(BACKEND + "/gerar-pdf", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dados)
        });

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "Curriculo-InfoLearn.pdf";
        a.click();

        addMsg(
            "Currículo gerado com sucesso. Obrigado por usar a Vagalume IA da InfoLearn Academy.",
            "ia"
        );
    });
}
</script>

</body>
</html>
