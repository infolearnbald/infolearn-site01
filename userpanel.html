<!DOCTYPE html>
<html lang="pt">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Painel â€” InfoLearn</title><link rel="stylesheet" href="style.css"></head>
<body>
<header class="topbar"><div class="brand"><img src="icon-192.png" width="48"><div><div class="logo">InfoLearn Academy</div></div></div></header>
<main class="container">
  <section class="card" id="panel" style="display:none"><h2>Bem-vindo</h2><div id="uinfo"></div><div style="margin-top:12px"><a class="btn" id="logout">Sair</a></div></section>
  <section class="card" id="public" style="display:none"><h2>Seus Cursos Gratuitos</h2><div id="myCourses" class="grid"></div></section>
</main>
<script type="module">
import { auth, db } from './firebase.js';
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

onAuthStateChanged(auth, async user=>{
  if(!user){ location.href='auth.html'; return; }
  const docu = await getDoc(doc(db,'users',user.uid));
  document.getElementById('panel').style.display='block';
  document.getElementById('uinfo').innerHTML=`<p><strong>${docu.data()?.name || user.email}</strong></p><p class="muted">${user.email}</p>`;
  // show free courses (static)
  document.getElementById('public').style.display='block';
  const q = query(collection(db,'courses'), where('type','==','free'));
  const snap = await getDocs(q);
  const c=document.getElementById('myCourses'); c.innerHTML='';
  snap.forEach(d=>{ const v=d.data(); const el=document.createElement('div'); el.className='curso-card'; el.innerHTML=`${v.thumbnail?`<img src="${v.thumbnail}">`:''}<div class="body"><h3>${v.title}</h3><p class="muted">${v.description||''}</p><a class="btn" href="course-free.html?id=${d.id}">Acessar</a></div>`; c.appendChild(el); });
});

document.getElementById('logout').addEventListener('click', async ()=>{ await signOut(auth); location.href='index.html'; });
</script>
</body>
</html>
